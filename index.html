<html>
    <head>
        <style>
            pre {
                font-size: 40px;
            }
        </style>
    </head>
    <body>
        <div id="content"></div>
        <script>

const F = 3;

async function getData() {
    var data = await fetch("https://dl.dropboxusercontent.com/s/4xsatr8ujknxony/baby.log");
    var logs = (await data.text()).split('\n').reverse().filter(l => !!l.trim().length);
    var total24h = 0;
    var total24hLimit = (new Date()).getTime() - 24 * 60 * 60 * 1000;
    var breastD = 0;
    var bottleD = 0;
    var display = logs.map((log) => {
        var d = parser(log);
        var t = d['type'] === 'bottle' ? '🍼' : '🤱';
        var time = d['timestamp'];
        var datetime = new Date();
        datetime.setTime(parseInt(time));

        if (datetime.getTime() < total24hLimit) {
            return '';
        } else {
            var am = parseInt(d.amount);
            var dr = parseInt(d.duration);
            total24h += d.type === 'breast' ? dr * F : am
            if (d.type === 'breast') {
                breastD += dr;
            } else {
                bottleD += dr;
            }
        }

        var datetimeDisplay = datetime.toString().split('(')[0];
        var a = d['amount'] !== '0' ? ' / ' + d.amount + ' ml' : ' / ~' + d.duration * F + ' ml';
        return `${datetimeDisplay.toString()} ${t} ${d['duration']} min${a}`
    }).filter(l => !!l.trim().length);;
    document.body.innerHTML = '<pre>'+`Last 24h: ${total24h} ml / ${breastD + bottleD} min (${bottleD} 🍼 + ${breastD} 🤱)\n---\n`+display.join('\n')+'</pre>';
}

function parser(line) {
    var dict = {};
    line.split(' ').forEach((kv) => {
        var [key, value] = kv.split('=');
        dict[key] = value;
    });
    return dict;
}

getData();


        </script>
    </body>
    </html>


