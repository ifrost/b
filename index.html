<html>
    <head>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono">
        <style>
            body {
                background-color: black;
                color: white;
                padding: 10px;
            }
            pre {
                font-size: 35px;
                font-family: "Roboto Mono", Courier;
            }
        </style>
    </head>
    <body>
        <div id="content"></div>
        <script>

const F = 3;

async function getData() {
    var data = await fetch("https://dl.dropboxusercontent.com/s/4xsatr8ujknxony/baby.log");
    var logs = (await data.text()).split('\n').reverse().filter(l => !!l.trim().length);
    var total24h = 0;
    var total24hLimit = (new Date()).getTime() - 24 * 60 * 60 * 1000;
    var breastD = 0;
    var bottleD = 0;
    var display = logs.map((log) => {
        var d = parser(log);
        var t = d['type'] === 'bottle' ? 'üçº' : 'ü§±';
        var time = d['timestamp'];
        var datetime = new Date();
        datetime.setTime(parseInt(time));

        if (datetime.getTime() < total24hLimit) {
            return '';
        } else {
            var am = parseInt(d.amount);
            var dr = parseInt(d.duration);
            total24h += d.type === 'breast' ? dr * F : am
            if (d.type === 'breast') {
                breastD += dr;
            } else {
                bottleD += dr;
            }
        }

        var datetimeDisplay = datetime.getHours().toString().padStart(2,'0') + ':' + datetime.getMinutes().toString().padStart(2,'0') + ' ' + datetime.getDate() + '/' + (datetime.getMonth() + 1);
        var a = d['amount'] !== '0' ?  d.amount + ' ml' : d.duration * F + ' ml';
        return `${datetimeDisplay.toString()} ${t} ${a} / 00:${d['duration'].toString().padStart(2,'0')}`
    }).filter(l => !!l.trim().length);;
    document.body.innerHTML = '<pre>'+`24h: ${total24h} ml / ${breastD + bottleD} min (${bottleD}üçº + ${breastD}ü§±)\n---\n`+display.join('\n')+'</pre>';
}

function parser(line) {
    var dict = {};
    line.split(' ').forEach((kv) => {
        var [key, value] = kv.split('=');
        dict[key] = value;
    });
    return dict;
}

getData();


        </script>
    </body>
    </html>


